<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WREN AI Companion</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* ===== Global Styles ===== */



    #startContainer {
  max-width: 320px;
  margin: 40px auto 30px auto; /* centers horizontally and adds vertical spacing */
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px; /* space between elements */
}

#startContainer label {
  font-weight: 600;
  font-size: 1rem;
  color: #444;
  user-select: none;
  text-align: center;
  width: 100%;
}

    html, body {
      margin: 0; padding: 0;
      font-family: 'Quicksand', sans-serif;
      background: #f9f9f9;
      height: 100%;
      color: #333;
      transition: background-color 0.5s ease, color 0.5s ease;
      user-select: none;
    }
    body.dark-mode {
      background: #121212;
      color: #ddd;
    }
    body.dark-mode main {
      background: linear-gradient(to right, #222, #333);
      color: #eee;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
    }

         #video-info {
  opacity: 0;
  transform: translateY(10px);
  transition: opacity 0.6s ease, transform 0.6s ease;
  pointer-events: none;
}

#video-info.show {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

body.dark-mode #video-info {
  background: #1e1e1e;
  color: #ddd;
}

    /* ===== Intro Screen ===== */
    #introScreen {
      position: fixed;
      z-index: 9999;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: black;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: opacity 1.5s ease;
    }
    #introScreen.fade-out {
      opacity: 0 !important;
      pointer-events: none;
    }
    .eyes {
      position: absolute;
      top: calc(50% - 80px);
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 24px;
      animation: fadeIn 2s forwards 1.5s;
      pointer-events: none;
      width: 80px;
      justify-content: center;
    }
    .eye {
      width: 20px; height: 20px;
      background: white;
      border-radius: 50%;
      animation: blink 4s infinite;
    }
    .eye:nth-child(2) {
      animation-delay: 2s;
    }
    @keyframes blink {
      0%, 90%, 100% { height: 20px; }
      95% { height: 2px; }
    }

    #introText {
      text-align: center;
      position: relative;
      margin-top: 40px;
    }
    #introLine1 {
      font-size: 1.4rem;
      margin: 0 0 8px 0;
      opacity: 0;
      animation: fadeIn 2s forwards 0.5s;
      line-height: 1.2;
      font-weight: 400;
      color: #ccc;
    }
    #introLine2 {
      font-size: 2.2rem;
      font-weight: 900;
      color: white;
      text-shadow: 0 0 5px white, 0 0 10px white, 0 0 20px white, 0 0 30px white;
      opacity: 0;
      animation: fadeIn 2s forwards 2.5s, wrenGlow 3s infinite ease-in-out 4.5s;
      line-height: 1.1;
      letter-spacing: 0.06em;
    }
    #introStar {
      display: block;
      margin: 20px auto 0;
      width: 60px; height: 60px;
      opacity: 0;
      animation: fadeIn 2s forwards 3.5s, starPulse 3s infinite ease-in-out 5s;
    }
    @keyframes starPulse {
      0%, 100% { fill: #1e88e5; opacity: 1; }
      50% { fill: #1e88e5; opacity: 0.7; }
    }
    @keyframes wrenGlow {
      0%, 100% {
        text-shadow: 0 0 5px white, 0 0 10px white, 0 0 20px white, 0 0 30px white;
        color: white;
      }
      50% {
        text-shadow: 0 0 2px white, 0 0 6px white, 0 0 10px white;
        color: white;
      }
    }
    @keyframes fadeIn {
      to { opacity: 1; }
    }

.fade-in {
  opacity: 0;
  animation: fadeInMain 1.5s forwards;
}

@keyframes fadeInMain {
  to {
    opacity: 1;
  }
}

    /* ===== Main App Styles ===== */
    main {
      display: none;
      max-width: 700px;
      margin: 40px auto 60px auto;
      padding: 30px 25px;
      background: linear-gradient(to right, #e3f2fd, #fbe9e7);
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      color: #333;
      box-sizing: border-box;
      min-height: 300px;
      transition: background 0.5s ease, color 0.5s ease, box-shadow 0.5s ease;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 25px;
      user-select: none;
    }
    label {
      margin-top: 18px;
      display: block;
      font-weight: 600;
      font-size: 1rem;
      color: #444;
      user-select: none;
    }
    input, select {
      padding: 12px 15px;
      margin-top: 8px;
      width: 100%;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
      background: white;
      color: #333;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #4caf50;
      box-shadow: 0 0 8px rgba(76, 175, 80, 0.4);
    }
    button {
      padding: 14px 0;
      font-size: 1.1rem;
      width: 100%;
      margin-top: 22px;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:hover:not(:disabled) {
      background-color: #388e3c;
    }
    button:disabled {
      background-color: #a5d6a7;
      cursor: wait;
    }
    #response, #modeResponse {
      margin-top: 22px;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
      white-space: normal;
      min-height: 2.2em;
      font-size: 1rem;
      color: #222;
      user-select: text;
      transition: background 0.5s ease, color 0.5s ease;
    }
    #modeSection {
      display: none;
      margin-top: 32px;
    }
    #bookCategoryGroup {
      display: none;
      margin-top: 18px;
    }


    #modeInstructions {
      margin-top: 8px;
      font-size: 0.9rem;
      color: #555;
      min-height: 10em;
      font-style: italic;
      white-space: pre-wrap;
      transition: color 0.5s ease;
    }
    #translationOptions {
      margin-top: 18px;
      padding: 12px 15px;
      background: #f0f4f8;
      border-radius: 10px;
      display: none;
      user-select: none;
      transition: background 0.5s ease, color 0.5s ease;
    }
    #translationOptions label {
      font-weight: normal;
      margin-right: 20px;
      cursor: pointer;
    }
    #translationOptions select {
      width: auto;
      display: inline-block;
      margin-left: 8px;
      font-size: 1rem;
      cursor: pointer;
    }
    body.dark-mode input,
    body.dark-mode select,
    body.dark-mode #response,
    body.dark-mode #modeResponse,
    body.dark-mode #translationOptions {
      background: #222;
      color: #ddd;
      border-color: #555;
    }
    body.dark-mode #modeInstructions {
      color: #ccc;
    }

    @font-face {
  font-family: 'Squartiqa 4F';
  src: url('/static/fonts/Squartiqa4F.woff2') format('woff2'),
       url('/static/fonts/Squartiqa4F.woff') format('woff'),
       url('/static/fonts/Squartiqa4F.ttf') format('truetype');
  font-weight: 400;
  font-style: normal;
}

.squartiqa {
  font-family: 'Squartiqa 4F', sans-serif;
}


  </style>
</head>
<body>
  <!-- ========== INTRO SCREEN ========== -->
  <div id="introScreen" aria-label="Welcome Screen" role="dialog" aria-modal="true">
    <div class="eyes" aria-hidden="true">
      <div class="eye"></div>
      <div class="eye"></div>
    </div>
    <div id="introText">
      <div id="introLine1">Hello there, friend</div>
      <div id="introLine2">I'm <span class="squartiqa">WREN</span></div>
      <!-- Star SVG -->
      <svg id="introStar" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="60" height="60" aria-hidden="true" focusable="false">
        <polygon points="32,4 39,24 60,24 42,38 48,60 32,46 16,60 22,38 4,24 25,24" fill="#1e88e5"/>
      </svg>
    </div>
  </div>

  <!-- ========== MAIN APP ========== -->
  <main role="main" aria-live="polite" style="display:none;">
    <h1 id="mainTitle">üëã Meet WREN ‚Äî Your AI Companion</h1>

    <!-- Dark Mode Toggle -->
    <label for="darkModeToggle" id="darkModeLabel" style="user-select:none; margin-bottom: 10px; cursor:pointer;">
      <input type="checkbox" id="darkModeToggle" /> Toggle Dark Mode
    </label>

    <div id="startContainer">
  <label for="nameInput" id="nameLabel">üìù Enter your name:</label>
  <input type="text" id="nameInput" placeholder="Your name here..." autocomplete="off" aria-describedby="nameLabel" />
  <button id="sendBtn"><span class="icon">‚û§</span> Send</button>
</div>

    <div id="response" aria-live="polite"></div>
    <div id="video-info"></div>

    <section id="modeSection" aria-label="Mode Selection and Interaction" style="display:none;">
      <label for="modeInput" id="modeLabel">üéØ Choose a Mode:</label>
      <select id="modeInput" aria-describedby="modeInstructions" aria-required="true">
        <option value="">-- Select a Mode --</option>
        <option value="1">ü§ñ Name Recognition</option>
        <option value="math">üßÆ Math Problem Solver</option>
        <option value="science">üî¨ Science Explainer</option>
        <option value="book">üìö Book Recommender</option>
        <option value="budget">üí∞ Budget Tracker</option>
        <option value="depression">ü©∫ Depression Screening</option>
        <option value="tidy">üè† House Tidying</option>
        <option value="voice">üéô Voice GUI Assistant</option>
        <option value="logs">üìú Memory Logs</option>
        <option value="translate">üåê Translate</option>
        <option value="reminder">‚è∞ Task Reminder</option>
      </select>

      <div id="modeInstructions" aria-live="polite" aria-atomic="true" style="margin-top:10px;"></div>

      <div id="modeTextInputGroup" style="margin-top: 20px; display: none;">
        <label for="modeTextInput">Your input:</label>
        <input type="text" id="modeTextInput" placeholder="Enter your question or info..." />
      </div>

      <div id="queryInputGroup" style="margin-top: 20px; display: none;">
        <label for="user-input">Ask a question:</label>
        <input type="text" id="user-input" placeholder="Ask a question..." autocomplete="off" />
      </div>

      <div id="bookCategoryGroup" style="margin-top: 20px; display: none;">
        <label for="bookCategory" id="bookCategoryLabel">Choose a book category:</label>
        <select id="bookCategory" aria-describedby="bookCategoryLabel">
          <option value="">-- Select a Category --</option>

        </select>
      </div>

      <div id="bookTypeGroup" style="margin-top: 16px; display: none;">
        <label id="bookTypeLabel">What kind of recommendation do you want?</label><br />
        <label><input type="radio" name="bookType" value="1" /> üìñ Book</label><br />
        <label><input type="radio" name="bookType" value="2" /> üéß Audiobook/Video</label><br />
        <label><input type="radio" name="bookType" value="3" checked /> üìö + üéß Both</label>
      </div>

      <div id="translationOptions" style="margin-top: 20px; display: none;">
        <label for="translateFrom" id="translateFromLabel">From:</label>
        <select id="translateFrom">
          <option value="auto">Auto Detect</option>
          <option value="en">English</option>
          <option value="es">Spanish</option>
          <option value="fr">French</option>
          <option value="de">German</option>
          <option value="zh">Chinese</option>
          <option value="ja">Japanese</option>
        </select>

        <label for="translateTo" id="translateToLabel" style="margin-left: 10px;">To:</label>
        <select id="translateTo">
          <option value="en">English</option>
          <option value="es">Spanish</option>
          <option value="fr">French</option>
          <option value="de">German</option>
          <option value="zh">Chinese</option>
          <option value="ja">Japanese</option>
        </select>
      </div>

       <div id="budgetChatContainer" style="display:none; border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: auto; margin-top: 20px; background: #f9f9f9;">

  </div>


  <button id="sendBtn" style="display:none; margin-top: 20px;">Send</button>

  <div id="output" style="white-space: pre-wrap; margin-top: 20px;"></div>

  <div id="modeResponse" aria-live="polite" aria-atomic="true" style="margin-top: 20px;"></div>

    </section>
  </main>

  <script>
    let currentUserId = null;

    window.addEventListener('load', () => {
      const intro = document.getElementById('introScreen');
      const main = document.querySelector('main');

      setTimeout(() => {
        intro.classList.add('fade-out');
        intro.addEventListener('transitionend', () => {
          intro.style.display = 'none';
          main.style.display = 'block';
          requestAnimationFrame(() => {
            main.classList.add('fade-in');
            document.getElementById('nameInput').focus();
          });
        }, { once: true });
      }, 9000);
    });

    // Dark mode toggle
    const darkModeToggle = document.getElementById('darkModeToggle');
    darkModeToggle.addEventListener('change', () => {
      document.body.classList.toggle('dark-mode', darkModeToggle.checked);
    });

    // Elements
    const startBtn = document.getElementById('startBtn');
    const responseDiv = document.getElementById('response');
    const modeSection = document.getElementById('modeSection');
    const modeInput = document.getElementById('modeInput');
    const sendBtn = document.getElementById('sendBtn');
    const modeResponse = document.getElementById('modeResponse');
    const nameInput = document.getElementById('nameInput');
    const bookCategoryGroup = document.getElementById('bookCategoryGroup');
    const bookCategorySelect = document.getElementById('bookCategory');
    const bookTypeGroup = document.getElementById('bookTypeGroup');
    const modeInstructions = document.getElementById('modeInstructions');
    const translationOptions = document.getElementById('translationOptions');

    // Update UI based on mode selection
    function updateModeUI() {
  const selected = modeInput.value;

  const modeSection = document.getElementById('modeSection');

  if (!selected) {
    modeSection.style.display = 'none';  // hide if no mode selected
  } else {
    modeSection.style.display = 'block'; // show when mode selected
  }

  // hide all optional UI elements as before
  document.getElementById('queryInputGroup').style.display = 'none';
  document.getElementById('modeTextInputGroup').style.display = 'none';
  bookCategoryGroup.style.display = 'none';
  bookTypeGroup.style.display = 'none';
  translationOptions.style.display = 'none';

  modeInstructions.textContent = '';

  switch (selected) {
    case 'math':
    case 'science':
      document.getElementById('queryInputGroup').style.display = 'block';
      modeInstructions.textContent = `Enter your ${selected === 'math' ? 'math problem' : 'science question'} above and click Send.`;
      break;
    case 'book':
      bookCategoryGroup.style.display = 'block';
      bookTypeGroup.style.display = 'block';
      modeInstructions.textContent = 'Select a book category and type, then click Send.';
      break;
    case 'translate':
      translationOptions.style.display = 'block';
      modeInstructions.textContent = 'Select languages and click Send to translate.';
      break;
    case '1': // Name Recognition
    case 'budget':
    case 'depression':
    case 'tidy':
    case 'voice':
    case 'logs':
    case 'reminder':
      document.getElementById('modeTextInputGroup').style.display = 'block';
      modeInstructions.textContent = 'Enter your in and click Send.';
      break;
    default:
      modeInstructions.textContent = '';
      break;
  }
}


    modeInput.addEventListener('change', updateModeUI);

    startBtn.addEventListener("click", async () => {
      const name = nameInput.value.trim();

      if (!name) {
        responseDiv.innerText = "‚ö†Ô∏è Please enter your name first.";
        return;
      }

      try {
        const response = await fetch("/start", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ name })
        });

        const result = await response.json();

        if (result.success) {
          currentUserId = result.userId;
          responseDiv.innerText = result.response || `‚úÖ Hello, ${name}! Please interact below to see what I can do for you!`;
          modeSection.style.display = 'block';
          modeInput.focus();
          startBtn.disabled = true;
          nameInput.disabled = true;
          sendBtn.style.display = 'inline-block';
        } else {
          responseDiv.innerText = `‚ùå ${result.error}`;
        }
      } catch (error) {
        console.error("Error:", error);
        responseDiv.innerText = "‚ùå Something went wrong. Try again.";
      }
    });

    sendBtn.addEventListener('click', async () => {
  const mode = modeInput.value;

  if (!mode) {
    modeResponse.textContent = '‚ö†Ô∏è Please select a mode.';
    return;
  }

  if (!currentUserId) {
    modeResponse.textContent = '‚ö†Ô∏è Please enter your name and start first.';
    return;
  }

  // Handle 'book' mode separately to call /api/audiobooks endpoint
  if (mode === 'book') {
    const selectedCategory = bookCategorySelect.value;
    const selectedType = document.querySelector('input[name="bookType"]:checked')?.value || "3";

    if (!selectedCategory) {
      modeResponse.textContent = '‚ö†Ô∏è Please select a book category.';
      return;
    }

    modeResponse.textContent = 'Loading book recommendations...';
    sendBtn.disabled = true;

    try {
      const res = await fetch('/api/book-recommendation', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          userId: currentUserId,
          category: selectedCategory.toLowerCase(),
          topic: selectedCategory.toLowerCase(), // Using category as topic for simplicity
          choice: selectedType
        }),
      });

      const data = await res.json();
      console.log("‚úÖ Raw backend response:", data);

      if (res.ok && data.success) {
        const parts = [];

        if (data.book) {
          const book = data.book;
          parts.push(`üìñ **Book Recommendation:**\n<strong>${book.title}</strong> by ${book.author}`);
        }

        if (data.audiobooks && data.audiobooks.length > 0) {
          parts.push(`üéß **Audiobooks:**`);
          parts.push(
            data.audiobooks
              .map(book => `<p><a href="${book.url}" target="_blank" rel="noopener noreferrer">${book.title}</a></p>`)
              .join('')
          );
        }

        if (!data.book && (!data.audiobooks || data.audiobooks.length === 0)) {
          parts.push('‚ö†Ô∏è No book or audiobook recommendations found.');
        }

        modeResponse.innerHTML = parts.join('<br><br>');
      } else {
        modeResponse.textContent = data.error || '‚ö†Ô∏è Failed to fetch recommendations.';
      }
    } catch (error) {
      console.error('Fetch error:', error);
      modeResponse.textContent = '‚ùå Network error fetching recommendations.';
    } finally {
      sendBtn.disabled = false;
    }

    return; // Skip rest of the handler
  }

  // Handle 'budget' mode with chat-like UI
  if (mode === 'budget') {
  const userInput = document.getElementById('modeTextInput').value.trim();
  if (!userInput) {
    modeResponse.textContent = '‚ö†Ô∏è Please enter your input above.';
    return;
  }

  const chatContainer = document.getElementById('budgetChatContainer');

  // Append user message
  const userMessage = document.createElement('div');
  userMessage.textContent = `You: ${userInput}`;
  userMessage.style.fontWeight = 'bold';
  userMessage.style.marginBottom = '8px';
  chatContainer.appendChild(userMessage);
  chatContainer.scrollTop = chatContainer.scrollHeight;

  // Clear input box
  document.getElementById('modeTextInput').value = '';

  // Show bot "typing..." indicator
  const botMessage = document.createElement('div');
  botMessage.textContent = 'WREN is typing...';
  botMessage.style.fontStyle = 'italic';
  chatContainer.appendChild(botMessage);
  chatContainer.scrollTop = chatContainer.scrollHeight;

  try {
    sendBtn.disabled = true;

    // Prepare payload for budget mode
    const payload = {
      userId: currentUserId,
      mode: mode,
      input: userInput
    };

    const res = await fetch('/mode', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
    });

    if (!res.ok) {
      const errorText = await res.text();
      console.error('Server error response:', errorText);
      modeResponse.textContent = `‚ùå Server error: ${res.status} ${res.statusText}`;
      chatContainer.removeChild(botMessage);
      return;
    }

    const data = await res.json();
    console.log('Backend response:', data);

    // Remove "typing..." message
    chatContainer.removeChild(botMessage);

    if (data && data.success === false) {
      const errorDiv = document.createElement('div');
      errorDiv.textContent = `‚ö†Ô∏è ${data.error || 'Request failed.'}`;
      chatContainer.appendChild(errorDiv);
    } else if (data && data.response) {
      const botReply = document.createElement('div');
      botReply.innerHTML = markdownToHtml(data.response);
      chatContainer.appendChild(botReply);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    } else {
      const warnDiv = document.createElement('div');
      warnDiv.textContent = '‚ö†Ô∏è No response from backend.';
      chatContainer.appendChild(warnDiv);
    }

  } catch (error) {
    console.error('Fetch error:', error);
    modeResponse.textContent = '‚ùå Network or parsing error.';
    chatContainer.removeChild(botMessage);
  } finally {
    sendBtn.disabled = false;
  }

  return; // no further processing
}

  // All other modes handled here as before
  let modeToSend;
  if (mode === 'science') {
    modeToSend = 'science';
  } else if (mode === 'math') {
    modeToSend = 'math';
  } else {
    modeToSend = mode;
  }

  // Prepare payload with userId and mode
  const payload = { userId: currentUserId, mode: modeToSend };

  if (mode === 'translate') {
    payload.translateFrom = document.getElementById('translateFrom').value;
    payload.translateTo = document.getElementById('translateTo').value;

    const textToTranslate = prompt('Enter the text you want to translate:', '');
    if (textToTranslate === null || textToTranslate.trim() === '') {
      modeResponse.textContent = 'Translation cancelled.';
      return;
    }

    payload.input = textToTranslate.trim();
  } else {
    // Other modes
    let userInput = '';
    if (mode === 'math' || mode === 'science') {
      userInput = document.getElementById('user-input').value.trim();
    } else {
      userInput = document.getElementById('modeTextInput').value.trim();
    }

    if (mode === '1' && !userInput) {
      userInput = nameInput.value.trim();
    }

    if (!userInput) {
      modeResponse.textContent = '‚ö†Ô∏è Please enter your input above.';
      return;
    }

    payload.input = userInput;
  }

  console.log("Sending to backend:", payload);

  try {
  sendBtn.disabled = true;
  modeResponse.textContent = 'Loading...';

  console.log('Sending payload:', payload);

  const res = await fetch('/mode', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload),
  });

  const data = await res.json();

  if (res.ok) {
    if (mode === 'math') {
      // Extract the first number or decimal from the response text
      const answerMatch = data.response.match(/[-+]?\d*\.?\d+/);
      if (answerMatch) {
        modeResponse.textContent = answerMatch[0];
      } else {
        modeResponse.textContent = data.response && data.response.trim() !== '' ? data.response : 'No answer received.';
      }
    } else {
      modeResponse.textContent = data.response || '‚úÖ Done.';
    }
  } else {
    modeResponse.textContent = data.error || '‚ö†Ô∏è Something went wrong.';
  }
} catch (error) {
  console.error('Fetch error:', error);
  modeResponse.textContent = '‚ùå Network error.';
} finally {
  sendBtn.disabled = false;
}
});

    // Simple markdown to HTML converter for bold and italics
    function markdownToHtml(markdown) {
      let html = markdown
        .replace(/(?:\*\*|__)(.*?)\1/g, '<strong>$1</strong>') // bold
        .replace(/(?:\*|_)(.*?)\1/g, '<em>$1</em>'); // italics
      html = html.replace(/\n/g, '<br>');
      return html;
    }

    // Fetch YouTube video info
    async function getYouTubeVideoInfo(videoId) {
      const videoInfoDiv = document.getElementById('video-info');
      videoInfoDiv.innerHTML = 'Loading video info...';

      try {
        const res = await fetch(`/video-info?id=${encodeURIComponent(videoId)}`);
        if (!res.ok) throw new Error('Failed to fetch video info');
        const data = await res.json();

        if (data && data.title && data.description) {
          videoInfoDiv.innerHTML = `
            <h2>${data.title}</h2>
            <p>${data.description}</p>
            <p><a href="https://youtu.be/${videoId}" target="_blank" rel="noopener">Watch on YouTube</a></p>
          `;
        } else {
          videoInfoDiv.innerHTML = 'Video information not available.';
        }
      } catch (error) {
        console.error(error);
        videoInfoDiv.innerHTML = 'Error fetching video info.';
      }
    }

    // Initial UI setup: hide modeSection and sendBtn
    modeSection.style.display = 'none';
    sendBtn.style.display = 'none';

    document.addEventListener('DOMContentLoaded', () => {
  const bookCategoryDropdown = document.getElementById('bookCategory');

  if (bookCategoryDropdown) {
    fetch('/api/book-categories')
      .then(response => response.json())
      .then(categories => {
        bookCategoryDropdown.innerHTML = '<option value="">-- Select a Category --</option>';
        categories.forEach(category => {
          const option = document.createElement('option');
          option.value = category;
          option.textContent = category.charAt(0).toUpperCase() + category.slice(1);
          bookCategoryDropdown.appendChild(option);
        });
      })
      .catch(error => {
        console.error('Failed to load book categories:', error);
        bookCategoryDropdown.innerHTML = '<option value="">‚ö†Ô∏è Failed to load</option>';
      });
  }
});


  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      background: white;
      color: #333;
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
    }

    .dark-mode {
      background-color: #121212;
      color: #eee;
    }

    .fade-out {
      opacity: 0;
      transition: opacity 1s ease-out;
    }

    .fade-in {
      opacity: 1;
      transition: opacity 1s ease-in;
    }

    #introScreen {
      text-align: center;
      margin-top: 100px;
      font-size: 1.5rem;
    }

    #introStar {
      margin-top: 20px;
      fill: #1e88e5;
    }

    label {
      font-weight: bold;
    }

    input[type="text"], select {
      padding: 8px;
      margin-top: 5px;
      margin-bottom: 10px;
      width: 100%;
      max-width: 300px;
      box-sizing: border-box;
    }

    button {
      padding: 10px 15px;
      font-size: 1rem;
      cursor: pointer;
      background-color: #1e88e5;
      color: white;
      border: none;
      border-radius: 4px;
    }

    button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }

    a {
      color: #1e88e5;
    }

    a:hover {
      text-decoration: underline;
    }
  </style>
</body>
